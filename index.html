<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Sala – Aprendedor al centro</title>

  <!-- ---------------------  FullCalendar  --------------------- -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/icalendar@6.1.10/index.global.min.js"></script>

  <style>
    body{font-family:sans-serif;margin:0;padding:1rem;}
    img#foto{float:right;max-width:220px;height:auto;margin-left:1rem;border-radius:6px}
    #cal{margin-top:1rem}
  </style>
</head>

<body>
  <!-- 1. Datos fijos de la sala -------------------------------------------- -->
  <img id="foto" src="salasMTY-Vertical.png" alt="Foto sala">
  <h2 id="nombre">Sala – Aprendedor al centro</h2>
  <p  id="info">Campus MTY · Centrales Norte piso 2<br>16 personas · Proyector, cámara, audio</p>

  <!-- 2. Calendario --------------------------------------------------------- -->
  <div id="cal">Cargando agenda…</div>

  <script>
  document.addEventListener('DOMContentLoaded', async ()=>{

    /* -------- 1. URL público del ICS + proxy CORS -------- */
    const RAW_ICS = "https://outlook.office365.com/owa/calendar/171f51fb1da64999af83fed6a931c693@tecmx.onmicrosoft.com/821c413038c64167a4dd104d2e55398e10998648141616686602/calendar.ics";
    const FEED    = "https://api.allorigins.win/raw?url=" + encodeURIComponent(RAW_ICS);

    /* -------- 2. Instancia de FullCalendar -------- */
    const cal = new FullCalendar.Calendar(document.getElementById('cal'), {
      plugins: [ FullCalendar.icalendarPlugin, FullCalendar.timeGridPlugin ],
      locale:  'es-mx',
      initialView: 'timeGridDay',
      nowIndicator: true,
      height: '85vh',

      headerToolbar:{
        left:   'prev,next today',
        center: 'title',
        right:  'timeGridDay,timeGridWeek,listDay'
      },
      buttonText:{ today:'Hoy', day:'Día', week:'Semana', list:'Lista' },
      events:{ url: FEED, format:'ics' },
      eventColor:'#0078d4',
      slotMinTime:'07:00', slotMaxTime:'22:00'
    });
    cal.render();

    /* -------- 3. Auto-refresh -------- */
    setInterval(()=>cal.refetchEvents(), 5*60*1000);           // cada 5 min
    const msToMidnight = new Date().setHours(24,5,0,0) - Date.now();
    setTimeout(function jump(){ cal.today(); cal.refetchEvents();
                                setTimeout(jump, 86400000); }, msToMidnight);
  });
  </script>
</body>
</html>
